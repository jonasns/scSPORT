# scSPOT
Single cell suppression profiling of human regulatory T cells (Tregs)

scSPOT itself is not an application, but the R code used to analyze the data in the manuscript. There are no novel functions, but just rather a workflow on how to use scDivisionPro and functions published elsewhere to analyze a dataset like this.   

In **Part 1 and Part 2** of the R notebooks, the cell types are identified and a combined SingleCellExperiment file is generated:   

At first, unused, DNA, barcode, gaussian parameter, and viability channels were removed with Premessa. Next, cell types were identified by top level FlowSOM clustering using CATALYST followed by manual merging of clusters based on canonical lineage markers into CD4 T cells, CD8 T cells, B cells, myeloid cells, NK cells and metabolome-low cells using the following markers: CD4, CD8, CD19, CyclinB1, IgD, PDL1, Tbet, CXCR5, Puro, CD86, CytC, CD11c, and HLA-DR. The clusters CD4 T cells, CD8 T cells, B cells, and myeloid cells, were further sub-clustered one by one using a similar principle. CD4 T cells were first clustered to Tregs (using the markers: Foxp3, Helios, CD25, CD4, CD39, PD1, Ki67, CTLA4, CD45RA, CCR7, cCasp3, TCF1, CFSE, OGDH, XBP1, GzmB, Puro, and CD98, which was subsetted to Tfr by manual gating of CXCR5, and high dimensional clustering by FlowSOM to eTreg and nTreg using the markers: CD45RA, CD25, Foxp3, Ki67, CFSE, CD39, CCR6, and TCF1. The remainder of the CD4 T cells were divided into CD4-naive, Th1, Th2, Th17, Tfh, and metab-lo cells using high dimensional clustering by FlowSOM and the markers: CXCR5, CCR7, CD45RA, CXCR3, CD25, Tbet, CCR4, CCR6, CD98, CD38, TCF1, CytC, CFSE, Ki67, CyclinB1, HLA-DR, and CD39. CD8 T cells were clustered to naïve, CM, EM, and TEMRA using the markers: CD45RA, CCR7, Ki67, CD27, CD38, and CFSE. B cells were clustered to naïve, memory, activated, and plasmablasts using the markers: IgD, CD27, CD38, CD11c, Tbet, CD98, CD39, CytC, CXCR5, CCR6, and CCR7. Myeloid cells were clustered to HLA-DR low, medium, and high, due to a lack of other identifying markers after five days in culture (markers used for FlowSOM clustering: HLA-DR, Puro, CD11c, CD86, and CCR7). Each of these sub-clustering was done in separate SingleCellExperiment (sce) objects, which was subsequently merged to one sce for further analysis.   

In **Part 3** of the R notebooks, differential abundance (DA) and differential expression (DE) analysis by diffcyt is performed:  

Differential abundance (DA) and differential expression (DE) analysis was done by diffcyt, and results were plotted as volcano plots using ggplot2 (Fig. 1e-f, Fig. 3f,i, Fig. 4c-e, Fig. 5a-c). Prior to each DA/DE analysis, the sce was subsetted to the replicates used in the comparison. For instance, for the comparison of Treg subsets, the sce contained all replicates that had paired samples for all three Treg subsets. We had additional replicates for only eTreg (used in Fig. 1), which were not in the sce for the Treg subset comparison. This is due to the statistics being affected by all the samples present in the sce when conducting diffcyt (multiple testing correction). For DA/DE analysis, the Tregs have been removed computationally in Fig. 1, as otherwise the presence or absence of the Tregs themselves would be the largest frequency change. This is only done in Fig. 1 and Fig. 4a-e.   

In **Part 4** of the R notebooks, density UMAPs are plotted, metabolome-low cells are analyzed, eTreg is compared to nTreg-derived eTreg, boxplots e.g. CTLA4-blocking and cell percentages are generated, overlay histograms are made (like classic flow cytometry histograms), and cell cycle analysis is performed (manual gating and quantification):  

When comparing cell types or states (such as division number), rather than conditions, findmarkers (in scran) was used instead of diffcyt. This is because diffcyt statistics is built for comparing conditions, and findmarkers statistics is built for comparing cell types or states. In findmarkers we retrieved the fold change using test.type = “t”, while the FDR values were obtained using test.type = “wilcox”. Density UMAPs were calculated using stat_density_2d in ggplot2, with the following settings: geom = “polygon”, contour = TRUE, aes(fill = after_stat(level)), bins = 10.  

In **Part 5** of the R notebooks, all analysis concerning cell divisions are performed. The cell division calling code has been made user-friendly in scDivisionPro (https://github.com/jonasns/scDivisionPro)  

To calculate the frequency of cells in each division, the cells are first divided into division numbers using scDivisionPro. Afterwards percentage in each division is calculated by: (# of cells in divX)/(total # of cells) *100%. The percentage proliferated is the percentage of cells that are not in division 0. The division index is the average number of cell divisions that a cell in the original population has undergone. It is calculated by the total number of divisions divided by the number of cells at the start of the culture.
